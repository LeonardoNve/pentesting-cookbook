#!/usr/bin/env bash
if [ "$(id -u)" != "0" ]; then
    echo 'Must be run as root!' 1>&2
    exit 1
fi

if [ ! $USERNAME ]; then
    echo '$USERNAME variable must be set!' 1>&2
    exit 1
fi

export DEBIAN_FRONTEND=noninteractive

OLD_PWD=$PWD

echo -e '\e[33;1;3m░▒▓ Setting locale ▓▒░\e[0m'
. kali.locale.sh
cd $OLD_PWD

echo -e '\e[33;1;3m░▒▓ Updating ▓▒░\e[0m'
apt-get -y -o Dpkg::Options::="--force-confdef" -o Dpkg::Options::="--force-confold" update
apt-get -y -o Dpkg::Options::="--force-confdef" -o Dpkg::Options::="--force-confold" upgrade

echo -e '\e[33;1;3m░▒▓ Installing packages ▓▒░\e[0m'
. kali.deps.base.sh
cd $OLD_PWD
. kali.deps.src.sh
cd $OLD_PWD
source kali.deps.rpi.sh
cd $OLD_PWD

echo -e '\e[33;1;3m░▒▓ Configuring environment ▓▒░\e[0m'
. kali.env.sh
cd $OLD_PWD

echo -e '\e[33;1;3m░▒▓ Hardening ▓▒░\e[0m'
. kali.hardening.sh
cd $OLD_PWD

echo -e "\e[32;1;5mDone!\e[0m"
